#!/bin/bash

# 2014 Jon Suderman
# https://github.com/suderman/local

# Helper function for pretty messages
msg() { printf "\e[0;32m=> \e[0;37m$1\e[0m\n"; }
msg-nl() { printf "\n\e[0;32m=> \e[0;37m$1\e[0m\n"; }
msg-install() { printf "\n\e[0;32m=> \e[0;37mInstalling \e[0;36m$1\e[0;37m...\e[0m\n"; }
msg-ask() { 
  if [ "$answer" == "y" ]; then msg-install $1;
  else
    printf "\n\e[0;32m=> \e[0;37mDo you want to install \e[0;36m$1\e[0;37m on this computer?\e[0m" 
    read -p " y/[n] " -n 1 -r; echo
    [[ $REPLY =~ ^[Yy]$ ]]
    if [ ! $? -ne 0 ]; then return 0; else return 1; fi
  fi
}

# Don't ask questions, just install/update everything 
answer="ask"; if [ "$1" == "y" ]; then answer="y"; fi

# Run init only if this script is called direct
if [ "$2" != "skip-init" ]; then init "$answer" skip-update; fi


# What I need to get going on Ubuntu
# --------------------------------

# Install script starts here!
msg-nl "Keeping Ubuntu up to snuff..."

# Install packages
if msg-ask "Apt, Homebrew, Node, Python and Ruby packages"; then 
  
  msg "Updating packages in Aptfile"
  sudo apt-bundle ~/.local/ubuntu/Aptfile

  msg "Updating packages in Brewfile"
  brew bundle ~/.local/ubuntu/Brewfile

  msg-nl "Updating packages in Npmfile"
  npm-bundle ~/.local/ubuntu/Npmfile

  msg-nl "Updating packages in Pipfile"
  pip install -r ~/.local/ubuntu/Pipfile

  msg-nl "Updating packages in Gemfile"
  cd ~/.local/ubuntu && bundle install
fi

msg-nl "...done!"


